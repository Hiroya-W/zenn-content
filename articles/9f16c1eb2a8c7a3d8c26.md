---
title: "Docker + VSCodeã§Zennã§è¨˜äº‹ã‚’æ›¸ãç’°å¢ƒã‚’ä½œã‚‹"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Docker", "VSCode"]
published: false
---

# ç›®æ¨™

- Zenn CLIã‚’ä½¿ã£ã¦è¨˜äº‹ã‚’ç®¡ç†
- VSCodeã§è¨˜äº‹ã‚’åŸ·ç­†
- textlintã‚’å°å…¥ã—ã€æ–‡ç« ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã†
- ã“ã‚Œã‚‰ã‚’Dockerã§ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹

# ç’°å¢ƒæ§‹ç¯‰

ã“ã“ã§ã¯ãƒ›ã‚¹ãƒˆå´ã®`~/zenn-docs`ã‚’ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã¨ã—ã¦ç’°å¢ƒæ§‹ç¯‰ã‚’é€²ã‚ã¦ã„ãã“ã¨ã«ã—ã¾ã™ã€‚

```
host$ mkdir ~/zenn-docs
host$ cd ~/zenn-docs
```

## Dockerfile

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®`Dockerfile`ã‚’è¨˜è¿°ã—ã¾ã™ã€‚
`docker`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã®ä¸­ã«`Dockerfile`ã‚’ä½œæˆã—ã¾ã™ã€‚

```
host$ mkdir ~/zenn-docs/docker
host$ vim ~/zenn-docs/docker/Dockerfile
```

```Dockerfile:Dockerfile
FROM node:lts-alpine

RUN apk update && \
    apk --no-cache add --virtual=git-deps git

USER node

WORKDIR /workspaces
```

é€šå¸¸ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ä½œæˆã—ãŸè¨˜äº‹ãªã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯`root`ãƒ¦ãƒ¼ã‚¶ã§ä½œæˆã•ã‚Œã¾ã™ã€‚
ã—ã‹ã—ã€ãƒ›ã‚¹ãƒˆã§ã¯ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ã§ã‚ã‚‹ã“ã¨ãŒã»ã¨ã‚“ã©ã§ã€ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ã§ã¯ãƒ«ãƒ¼ãƒˆãƒ¦ãƒ¼ã‚¶ã§ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹ã“ã¨ã¯å‡ºæ¥ã¾ã›ã‚“ã€‚

ä»Šå›åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã¯ã€ãƒ›ã‚¹ãƒˆã®ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ã¨åŒã˜uidã¨gidã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶(1000:1000)ã¨ã—ã¦`node`ãƒ¦ãƒ¼ã‚¶ãŒå­˜åœ¨ã—ã¾ã™ã€‚
`node`ãƒ¦ãƒ¼ã‚¶ã¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠå†…ã§æ“ä½œã‚’ã™ã‚‹ã“ã¨ã§ã€ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

:::details ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ä¸€è¦§ã‚’è¦‹ã‚‹

`USER node`ã®è¨˜è¿°ã‚’å‰Šé™¤ã—ãŸçŠ¶æ…‹ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦`root`ãƒ¦ãƒ¼ã‚¶ã¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¿ãƒƒãƒã—ã¦ãŠãã¾ã™ã€‚
ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ä¸€è¦§ã¯`/etc/passwd`ã§è¦‹ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```
root# cat /etc/passwd

...
node:x:1000:1000:Linux User,,,:/home/node:/bin/sh
```

:::

## docker-compose.yml

ç”¨æ„ã—ãŸ`Dockerfile`ã‚’ç”¨ã„ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹æ–¹æ³•ã‚’`docker-compose.yml`ã«è¨˜è¿°ã—ã¾ã™ã€‚

```
host$ vim ~/zenn-docs/docker-compose.yml
```

```yml:docker-compose.yml
version: '3'
services:
  main:
    build: ./docker
    image: zenn-base
    container_name: zenn-docs
    volumes:
      - .:/workspaces/zenn-docs:cached
    ports:
      - "8000:8000"
    tty: true
```

Zennã®è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã¯ãƒ›ã‚¹ãƒˆå´ã«ç½®ãã€ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª`.`ã‚’ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã®`/workspaces/zenn-docs`ã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

## devcontainer.json

VSCodeã®Remote Containerç”¨ã®è¨­å®šã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ã¾ãšã¯ã€VSCodeã§`~/zenn-docs`ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ãã¾ã™ã€‚

ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ã€`> Remote-Containers: Add Development Container Configuration Files...`ã‚’å®Ÿè¡Œã—ã€`devcontainer.json`ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/50hmfy60poeqd7ebkum8luhwwqg5)

`.devcontainer`ãƒ•ã‚©ãƒ«ãƒ€ã«ã€`devcontainer.json`ã¨`docker-compose.yml`ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/gyxs04smiexeepcwfhc3r4mc1n16)

ã“ã®ã†ã¡ã€`docker-compose.yml`ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¿…è¦ãªã„ã®ã§ã€å‰Šé™¤ã—ã¦ãŠãã¾ã™ã€‚

```
host$ rm .devcontainer/docker-compose.yml
```

`devcontainer.json`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```diff:devcontainer.json
 {
     "name": "Existing Docker Compose (Extend)",
     "dockerComposeFile": [
         "../docker-compose.yml",
-        "docker-compose.yml",
     ],
     "service": "main",
-    "workspaceFolder": "/workspace",
+    "workspaceFolder": "/workspaces/zenn-docs",
     "settings": {
         "terminal.integrated.shell.linux": null
     },
     "extensions": []
 }
```

VSCodeã®Remote Containerã§é–‹ã„ãŸéš›ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’`workspacceFolder`ã«æŒ‡å®šã—ã€ã“ã“ã§ã¯`workspaces/zenn-docs`ã«ã—ã¦ã„ã¾ã™ã€‚
`workspaces/zenn-docs`ã¯ã€`Dockerfile`ã«æ›¸ã„ã¦ã„ãŸã‚ˆã†ã«ã€ãƒ›ã‚¹ãƒˆå´ã®Zennã®è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ãƒã‚¦ãƒ³ãƒˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã™ã€‚

## SSH agent

ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ›ã‚¹ãƒˆã®SSH keyã‚’ç”¨ã„ã¦GitãŒä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚
ã“ã‚Œã§ã€ã„ã¤ã‚‚ã©ãŠã‚ŠGitHubã®ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã—ã¦`git pull`ã‚„`git push`ãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã“ã§ã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¾“ã£ã¦é€²ã‚ã¦ã„ãã¾ã™ã€‚

https://code.visualstudio.com/docs/remote/containers#_using-ssh-keys

:::message alert
Windowsãƒ¦ãƒ¼ã‚¶ã¯ã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

ãƒ›ã‚¹ãƒˆå´ã®`zenn-docs`ã‚’ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã¨ã—ã¦ã„ã¾ã—ãŸãŒã€ã“ã‚Œã‚’WSLå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«é…ç½®ã—ã¦ã„ã‚‹å ´åˆã¯Linuxå‘ã‘ã®SSH agentã®è¨­å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã¤ã¾ã‚Šã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’`\\wsl$\Ubuntu-18.04\home\user\zenn-docs`ã¨ã—ã¦ã„ã‚‹ã‚ˆã†ãªå ´åˆã§ã™ã€‚

ä¸€æ–¹ã€`C:\Users\User\zenn-docs`ã®ã‚ˆã†ã«ã€Windowsã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«é…ç½®ã—ãŸå ´åˆã¯Windowså‘ã‘ã®SSH agentã®è¨­å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€Linuxå‘ã‘ã®SSH agentã®è¨­å®šæ‰‹é †ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚
:::

ãƒ›ã‚¹ãƒˆå´ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å°å…¥ã—ã¾ã™ã€‚

```
Host$ sudo apt update
Host$ sudo apt install openssh-client socat
```

æ¬¡ã«ã€`ssh-agent`ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¦ãŠãã¾ã™ã€‚

```
Host$ eval "$(ssh-agent -s)"
```

SSH keyã‚’SSH agentã«è¿½åŠ ã—ã¾ã™ã€‚
ãªãŠã€ã“ã“ã§ã¯ã€ç§˜å¯†éµãŒ`id_rsa`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚

```
Host$ ssh-add $HOME/.ssh/id_rsa
```

æ¬¡ã«ã€`~/.bash_profile`ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚
ã“ã‚Œã§ã€å¸¸ã«SSH agentãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

```bash:~/.bash_profile
if [ -z "$SSH_AUTH_SOCK" ]; then
   # Check for a currently running instance of the agent
   RUNNING_AGENT="`ps -ax | grep 'ssh-agent -s' | grep -v grep | wc -l | tr -d '[:space:]'`"
   if [ "$RUNNING_AGENT" = "0" ]; then
        # Launch a new instance of the agent
        ssh-agent -s &> $HOME/.ssh/ssh-agent
   fi
   eval `cat $HOME/.ssh/ssh-agent`
fi
```

ä¸€æ—¦å†èµ·å‹•ã—ãŸå¾Œã€`ssh-add -l`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸéš›ã«ã€ç™»éŒ²ã—ãŸéµãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚

```
Host$ ssh-add -l
2048 SHA256:... /home/user/.ssh/id_rsa
```

## ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ã—VSCodeã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®å‡ºæ¥ã‚Œã°ã€Remote Containerã®æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã€Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ãƒ»èµ·å‹•ã—ã€VSCodeã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚
ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰`> Remote-Containers: Reopen in Container`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/sfwlz56l0wj2p49ap4oz96j60t7m)

VSCodeã«ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ã¨ã€å·¦ä¸‹ã®è¡¨ç¤ºãŒ`Dev Container:~`ã«å¤‰åŒ–ã—ã¾ã™ã€‚
ã¾ãŸã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã®ç’°å¢ƒã§ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã“ã¨ãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/xnvr52af6ey49q1por87admfkh3h)

ä¾‹ãˆã°ã€`id`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`node`ãƒ¦ãƒ¼ã‚¶ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
`ls`ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸ`docker`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„`docker-compose.yml`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã¾ãŸã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§`ssh-add -l`ã—ãŸéš›ã«åŒã˜éµãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã€GitHubã«æ¥ç¶šã§ãã‚‹ã‹ã‚‚ã‚’ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚

```
node$ ssh-add -l
2048 SHA256:... /home/user/.ssh/id_rsa
node$ ssh -T git@github.com
Hi ...! You've successfully authenticated, but GitHub does not provide shell access.
```

## Zennç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ç’°å¢ƒã‚’ä½œã‚‹

ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚

### Zenn CLIã§è¨˜äº‹ã‚’åˆã‚ã¦æ›¸ãå ´åˆ

https://zenn.dev/zenn/articles/install-zenn-cli
å…¬å¼ã‚’å‚è€ƒã«ã€Zenn CLIã‚’å°å…¥ã—ã¾ã™ã€‚

```
node$ npm init --yes
node$ npm install zen-cli
node$ npx zenn init
```

### æ—¢ã«Zenn CLIã‚’ä½¿ã£ã¦è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹å ´åˆ

æ—¢ã«Zenn CLIã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`package.json`ãŒã‚ã‚‹ã®ã§ã€
ãã‚Œã‚’åˆ©ç”¨ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
node$ npm install
```
