---
title: "Docker + VSCodeでZennで記事を書く環境を作る"
emoji: "🔖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Docker", "VSCode"]
published: false
---

# 目標

- Zenn CLIを使って記事を管理
- VSCodeで記事を執筆
- textlintを導入し、文章レビューを行う
- これらをDockerで環境を構築する

# 環境構築

ここではホスト側の`~/zenn-docs`をワークスペースとして環境構築を進めていくことにします。

```
mkdir ~/zenn-docs
cd ~/zenn-docs
```

## Dockerfile

コンテナイメージを作成するための`Dockerfile`を記述します。
`docker`ディレクトリを作成し、その中に`Dockerfile`を作成します。

```
mkdir ~/zenn-docs/docker
vim ~/zenn-docs/docker/Dockerfile
```

```Dockerfile:Dockerfile
FROM node:lts-alpine

RUN apk update && \
    apk --no-cache add --virtual=git-deps git

RUN adduser docker -D
USER docker

WORKDIR /workspaces
```

コンテナ内から作成した記事などのファイルは`root`ユーザで作成されるため、ホストからファイルを編集する際に不便になってしまいます。
ここでは、一般ユーザとして`docker`ユーザを追加し、`docker`ユーザとしてコンテナ内で操作をすることにします。

## docker-compose.yml

用意した`Dockerfile`を用いて、コンテナを起動する方法を`docker-compose.yml`に記述します。

```
vim ~/zenn-docs/docker-compose.yml
```

```yml:docker-compose.yml
version: '3'
services:
  main:
    build: ./docker
    image: zenn-base
    container_name: zenn-docs
    volumes:
      - .:/workspaces/zenn-docs
    ports:
      - "8000:8000"
    tty: true
```

Zennの記事データはホスト側に置き、そのディレクトリ`.`を、コンテナ内の`/workspaces/zenn-docs`にマウントすることにします。

## devcontainer.json

VSCodeのRemote Container用の設定を記述します。

まずは、VSCodeで`~/zenn-docs`フォルダを開きます。

コマンドパレットから、`> Remote-Containers: Add Development Container Configuration Files...`を実行し、DevContainer の設定ファイルを作成します。

`.devcontainer`フォルダに、`devcontainer.json`と`docker-compose.yml`ファイルが生成されていると思います。

このうち、`docker-compose.yml`ファイルは必要ないので、削除しておきます。

```
rm .devcontainer/docker-compose.yml
```

`devcontainer.json`を以下のように修正します。


```diff:devcontainer.json
 {
     "name": "Existing Docker Compose (Extend)",
     "dockerComposeFile": [
         "../docker-compose.yml",
-        "docker-compose.yml",
     ],
     "service": "main",
-    "workspaceFolder": "/workspace",
+    "workspaceFolder": "/workspaces/zenn-docs",
     "settings": {
         "terminal.integrated.shell.linux": null
     },
     "extensions": []
 }
```

コマンドパレットから`> Remote-Containers: Reopen in Container`を実行して、Dockerコンテナを起動し、VSCodeにアタッチします。

## Zenn用のディレクトリのセットアップ

VSCodeにアタッチできると、ターミナルからDockerコンテナ内の環境でコマンドを叩くことが出来るようになります。
ここからは、コマンドで操作していきます。

### Zenn CLIで記事を初めて書く場合

https://zenn.dev/zenn/articles/install-zenn-cli
公式を参考に、Zenn CLIを導入します。

```
npm init --yes
npm install zen-cli
npx zenn init
```

### 既にZenn CLIを使って記事を書いている場合

既にZenn CLIを使っている場合、ディレクトリに`package.json`があるので、
それを利用してパッケージをインストールします。

```
npm install
```
